<app-nav-bar></app-nav-bar>

<h1 class="heading">SALES</h1>

<hr style="height: 1px; background-color: green; width: 80%; margin-left: 12%" />
<p-toast [showTransitionOptions]="'4ms'"></p-toast>

<div style="width: 100%" class="ui-g">
  <div class="ui-md-12 ui-lg-6 ui-sm-12">
    <p-card header="" [style]="{
        width: '95%',
        'font-size': '15px',
        'margin-left': '23.5%',
        'text-align': 'left',
        color: 'green'
      }">
      <h4 style="color: green; font-weight: bold">Point Of Sales Form :</h4>
      <hr style="height:2px;width:82%;background-color:green; margin-left: 1px;" />

      <div class="ui-g ui-fluid">
        <form style="width:100%;" #myForm="ngForm">
          <div class="ui-g">
            <!-- <div class="ui-md-1 ui-lg-1"></div> -->
            <div class="ui-md-12 ui-lg-10 ui-sm-12">
              <div class="ui-inputgroup">

               
                <p-dropdown
                  [options]="dropdownData"
                  (onChange)="onProductChange()"
                  [(ngModel)]="salesObj.productRegistration"
                  name="testname"
                  placeholder="Select Product"
                  pInputText
                  [style]="{height: '40px' }"
                  style="width: 100%"
                  [filter]="true"
                ></p-dropdown>

              </div>
            </div>
            <div class=" ui-md-2 ui-lg-2 ui-sm-12">
              <button pButton type="button" class="backBtnStyle" (click)="routetoProductRegistration()"
                style="width:75%;background: #479761;; " label="Add "></button>
            </div>
          </div>

          <div class="ui-g">
            <!-- <div class="ui-md-3 ui-lg-3"></div> -->
            <div class="ui-md-12 ui-lg-10 ui-sm-12">
              <div class="ui-inputgroup">

                <span
                  class="ui-inputgroup-addon"
                  style="width: 50%;font-size:15px;"
                  >Quantity: <i style="color: red">*</i></span
                >
                <input
                  type="number"
                  required
                  (keypress)="numberOnly($event)"
                  style="width: 100%"
                  name="quantity"
                  [disabled]="disableUnit()"
                  (input)=" calculatePriceQuantityProduct(); getProductQuantity()"
                  [(ngModel)]="salesObj.productQuantity"
                  pInputText
                />

              </div>
            </div>
          </div>

          <div class="ui-g">
            <!-- <div class="ui-md-1 ui-lg-1"></div> -->
            <div class="ui-md-12 ui-lg-10 ui-sm-12">
              <div class="ui-inputgroup">
                <span class="ui-inputgroup-addon" style="width:50%;font-size:15px;">Product Price: <i
                    style="color: red">*</i></span>
                <!-- <input type="text" required [(ngModel)]="test.details" name="details" pInputText> -->
                <input type="number" required (keypress)="numberOnly($event)" style="width: 100%" [disabled]="true"
                  name="productPrice" [(ngModel)]="salesObj.total" pInputText />
              </div>
            </div>
          </div>
          <div class="ui-g" style="margin-top:20px !important;">
            <div class="ui-md-3 ui-lg-3"></div>
            <div class="ui-md-5 ui-lg-5 ui-sm-12">
              <button pButton type="submit" label="Add to cart" (click)="callForChangeInProductStocks()" [disabled]="myForm.form.invalid  || salesObj.total==0"
                style="margin-top: 0px; background-color:#479761;width:100%;"></button>
            </div>
          </div>
        </form>
      </div>
    </p-card>
  </div>
  <div class="ui-md-12 ui-lg-5 ui-sm-12">
    <p-card [style]="{
        width: '81%',
        'font-size': '15px',
        'margin-left': '21%',
        'text-align': 'left',
        color: 'green'
      }">
      <div class="ui-g">
        <div class="ui-g-2">
          <h4 style="color: green; font-weight: bold">Cart :</h4>
        </div>
        <div class="ui-g-3">
          <img src="assets/icons8-shopping-cart-30.png" />
        </div>
        <div class="ui-g-1"></div>
        <div class="ui-g-3">
          <button pButton type="button"  printSectionId="print" ngxPrint  label="Print" 
            (click)="emptyPrintDataArray()" [disabled]="disablePrintButton"
            style="margin-top: 0px; background-color:#479761;width:100%;"></button>
        </div>
        <div class="ui-g-3">
          <button pButton type="button" label="Save" [disabled]="disablesavebutton" (click)="saveSales()"
            style="margin-top: 0px; background-color:#479761;width:100%;"></button>
        </div>
      </div>
      <hr style="height:2px;width:100%;background-color:green; margin-left: 1px;" />

      <!-- <p style="margin:10px" [hidden]="facilities.length">No Facility selected!</p> -->
      <p-table [ngStyle]="{ textAlign: 'center' }" [totalRecords]="totalRecords" #dt [paginator]="true" [rows]="5"
        [value]="tableData">
        <ng-template pTemplate="header">
          <tr>
            <th [ngStyle]="{ textAlign: 'center' }" *ngFor="let col of cols">
              {{ col.header }}
            </th>
            <th style="text-align: center;" pResizableColumn>
              Actions
            </th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-car let-rowData let-rowIndex>
          <tr [pSelectableRow]="rowData">
            <td *ngFor="let col of cols" style="overflow: auto">
              {{ car[col.field] }}
            </td>
            <td>
              <button pButton [ngStyle]="{ width: '70px', margin: '6px' }" type="button" label="Delete"
                (click)="deleteProduct(tableData.indexOf(rowIndex),rowData['total'])" class="ui-button-danger"></button>
            </td>
          </tr>
        </ng-template>
      </p-table>
  
      <div class="ui-g" style="margin-top: 4%;">
        <div class="ui-g-4">
          <div class="ui-g">       
            <h5 style="font-weight: bold;color: black">Total :</h5>
            <h6 style="margin-top: 2%;margin-left: 6%;color: black;font-size: large">{{total}}</h6>
          </div>
        </div>

      </div>
    </p-card>
  </div>
</div>
<div id="print" target="blank" [hidden]="true">
  <!-- <div *ngIf="addEmergency.name !== undefined"> -->

  <h1 style="text-align: center; color:green;font-weight:bold;">
    Sales Slip
  </h1>
  <hr style="border: 2px solid black;" />
  <div class="ui-g">
    <p style="font-size: 20px;">
      <b style="font-size: 20px;"> Date: </b> {{ printSlipDate | date: "short" }}
    </p>

    <div>
      <span style="font-weight:bold;">Product Name</span>
      <span style="font-weight:bold; margin-left: 225px">Quantity</span>
      <span style="font-weight:bold;float: right;">Price</span>
      <hr style="border: 1px solid black;width:100%;" />
      <div *ngFor="let data of printData">
        <span>{{ data.name }}</span>
        <span style=" margin-left: 295px">{{ data.quantity }}</span>
        <span style="float: right;">{{ data.total }}</span>
        <hr style="width:100%;" />
      </div>
      <div>


        <hr style="border:1px solid black;width:100%;" />
        <span><b> Total: </b> <span style="float:right;">{{ printTotal }}</span></span>
        <hr style="border:1px solid black;width:100%;" />
      </div>
    </div>
  </div>
</div>